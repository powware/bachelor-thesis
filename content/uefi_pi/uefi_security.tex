% !TeX root = ../../thesis.tex

\subsection{Security}

\subsubsection{Secure Boot}

Secure Boot provides a secure hand-off from the firmware to 3rd party applications used for during the boot process, located on unsecure media \cite{tianocore-understanding-uefi-secure-boot-chain} \cite[Sections 32.2 and 32.5.1]{uefi-spec}.
It assumes the firmware to be a trusted entity and all 3rd party software to be untrusted, this includes images from hardware vendors in \ac{PCI} option \acp{ROM}, bootloader from \ac{OS} vendors and tools such as the \ac{UEFI} shell \cite{tianocore-understanding-uefi-secure-boot-chain}.
Digital signatures, embedded within the \ac{UEFI} images, can be used to authenticate origin and/or integrity \cite[Section 32.2]{uefi-spec}.
This is done through asymmetric signing, component provider must sign their executables with their private key and publish the public key.
The public keys are stored in a signature \ac{DB} and before execution the signed executable can be verified against the database.
Multiple signatures can be embedded within the same image \cite[Section 32.2.2]{uefi-spec}.
The signatures are created by first calculating a hash over select parts of the executable, leaving, for example, the signatures out of the hashed data and then signing it with a private key.
The output of this hashing is called a digest and the algorithm for obtaining the digest is defined in \cite{microsoft-pe-signature-format}.
Secure Boot also disallows legacy booting through the \ac{CSM}.

Secure Boot is managed through three components, a \ac{PK}, one or more \ac{KEK} and the signature \acp{DB}.

\begin{description}
    \item[\ac{PK}]
        The \ac{PK} establishes a trust relationship between platform owner and firmware, the public half is enrolled into the firmware.
        The private half represents platform ownership, as it can be used to change or delete the \ac{PK} as well as enroll or modify \acp{KEK}.
    \item[\ac{KEK}]
        The \ac{KEK} establishes a trust relationship between \ac{OS} and firmware, as its private half is used to modify the signature \acp{DB}.
    \item[Signature \acfp{DB}]
        Signature \acp{DB} contain image hashes and certificates, to either allow or deny execution of associated images.
\end{description}

Internally these are all implemented by authenticated variables, residing in tamper resistant non-volatile storage \cite[Section 32.3]{uefi-spec}.
The \ac{PK} is a simple variable where the \ac{KEK} and \ac{DB} are implemented through signature list data structures \cite[Section 32.4.1]{uefi-spec}, the variable services can be used to append entries or to read and write the list as a whole \cite[Sections 32.3.5 and 32.5.3]{uefi-spec}.
The variables are part of the \hyperref[sec:uefi-pi:uefi:variables]{Globally Defined Variables}, for each variavble also exist a variant reserved for default entries. These can be used by an \ac{OEM} to supply platform\-/defined values, used during Secure Boot initialization.
Their contents can be copied to their live versions, used during Secure Boot operation.
The current state of Secure Boot is also reflected within a secure variable \cite[Section 3.3]{uefi-spec}.

% https://papers.vx-underground.org/papers/Other/Advanced%20Malware/UEFI%20Secure%20Boot%20in%20Modern%20Computer%20Security%20Solutions.pdf
Users, who are physically present, may disable Secure Boot, enroll default or custom keys via an interactive menu. \TODO{find a good cite}

\TODO{maybe secure boot authorization process}

\subsection{Firmware Management}

% https://microsoft.github.io/mu/dyn/mu_tiano_plus/FmpDevicePkg/Docs/FmpDevicePkg_ReadMe/

provides
CapsuleUpdate()
QueryCapsuleCapabilities()
of the runtime services table