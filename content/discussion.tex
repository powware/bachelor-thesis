% !TeX root = ../thesis.tex

% https://www.scribbr.com/research-paper/discussion/

% meaning, importance, and relevance of your results
% explaining and evaluating what you found, showing how it relates to your literature review

\chapter{Discussion}

Our attacks show that a BitLocker protected Windows 11 installations are less secure against \ac{UEFI} rootkits when using Secure Boot.
We refute Microsoft's statement that Windows is secure regardless of using \ac{TPM} profile \code{\{0, 2, 4, 11\}} or profile \code{\{7, 11\}} \cite{microsoft-pcr7-binding}.
Disregarding \ac{PCR}0 in the validation profile and instead using Secure Boot for integrity validation is an inherently dangerous approach, as Secure Boot relies on the firmware as its root of trust, meaning it can not verify its integrity.
\ac{PCR}7 may be able to replace registers 2 and 4 but not 0.

\ac{TPM} integrity measurements are only as effective as the user's reaction to them

bootkit installation easier than rootkit

rootkit with physical access very doable

secure boot defeats bootkit


Our attacks reveal the differences between \ac{UEFI} firmware rootkits and \ac{UEFI} bootkits.
The barrier of entry for a bootkit is much lower, as through physical access it is only required to boot from a \ac{USB} stick.
Remote infection by mounting the \ac{ESP}.
When the \ac{PF} is not password protected the main downside of a bootkit, its  we can disable secure boot
in case of physical presence it may require to change boot order
physical presence with bootable usb stick (defeated by secure boot)
genrally defeated by secure boot where as the rootkit isnt
even if secure boot was implemented for FV images, it could be patched if the validation change starts within the image

barrier of entry is higher
exploit to overwrite spi flash or be delivered with supply chain difficult
physical presence remove spi chip and emulate spi chip or modify chip content
but high payoff with persistence

% persistence
bootkit moves with hard drive but can be overwritten by fresh install
rootkit persistence across reinstallations or hard drive replacements


% SMM rootkit very powerful, complete control over the system
% \cite{}  https://pdfs.semanticscholar.org/68e7/42523f493b78111031a5a221a8cf767064f4.pdf

% attack assumption reflected to real world aplicability
didnt prevent firmware update overwriting our payload
generally the bitlocker reocvery prompt can raise suspicion and may lead to investigations and the threat to be found
BitLogger is more of a last resort and a social engineering aspect comparable to phishing
implications of windows secure boot PCR7 binding and use of secure boot system integrity check and validation profile 7, 11 is a bad decision of microsoft, that for example allows
stolen laptops to be unlocked when infecting the firmware with our rootkit


it is generally very easy to attack windows from the \ac{UEFI} environment and there is little that they can do, as especially all windows code can be patched


\section{Mitigations}

measured boot \TODO{maybe}

bios password against secure boot removal or bootkit installation from USB

windows cant assume what the implementation of ReadKeyStrokeEx looks like (normally function patching might have a jump etc, which we dont even have here)

hardware validated boot to start the validation change from outside the image

inaccessible spi flash

tpm + pin/usb detectability

\subsection{User awareness}

% https://learn.microsoft.com/en-us/windows/security/information-protection/bitlocker/bitlocker-group-policy-settings#configure-the-pre-boot-recovery-message-and-url
% https://learn.microsoft.com/en-us/windows/security/information-protection/bitlocker/bcd-settings-and-bitlocker
you can change recovery message and URL in BCD hive


% https://learn.microsoft.com/en-us/windows/security/information-protection/bitlocker/bitlocker-recovery-guide-plan

recovery guide

what causes bitlocker recovery
- password wrong too often
- TPM 1.2, changing the BIOS or firmware boot device order
- Having the CD or DVD drive before the hard drive in the BIOS boot order and then inserting or removing a CD or DVD
- Failing to boot from a network drive before booting from the hard drive.
- Docking or undocking a portable computer
- Changes to the NTFS partition table on the disk including creating, deleting, or resizing a primary partition.
- Entering the personal identification number (PIN) incorrectly too many times
- Upgrading critical early startup components, such as a BIOS or UEFI firmware upgrade
- Updating option ROM firmware graphics card
- Adding or removing hardware
- REMOVING, INSERTING, OR COMPLETELY DEPLETING THE CHARGE ON A SMART BATTERY ON A PORTABLE COMPUTER
- Pressing the F8 or F10 key during the boot process
what does the recovery screen say \autoref{fig:bitlocker-recovery-prompt}

% https://learn.microsoft.com/en-us/windows/security/information-protection/bitlocker/bitlocker-device-encryption-overview-windows-10
% https://learn.microsoft.com/en-us/mem/configmgr/protect/deploy-use/bitlocker/helpdesk-portal?source=recommendations
% https://learn.microsoft.com/en-us/microsoft-desktop-optimization-pack/mbam-v25/
Enables end users to recover encrypted devices independently by using the Self-Service Portal

googeln wie legitime recovery key prompt reaktion aussieht

enterprise policy recovery key einschraenkbar?

enterprise policy on recovery key loss

vermitteln was das prompt bedeuten koennte

aber kann man einfach nicht anzeigen lassen

Security Flaw of entering a Recovery Password in an inheritly unsafe System

enterprise doesnt hand out recovery keys and instead receives hard drive


!!!!!!!!!!!!!!!!!!!!!!!!!
without hardware chain of trust a compromised system can patch/change any software and fixes are impossible

phishing prompts on their own